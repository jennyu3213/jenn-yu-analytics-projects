---
title: "Cyclistic Bike Share Analysis"
author: "Jennie Yu"
date: "2025-12-15"
output:
  pdf_document: default
  html_document: default
---

---
title: "Cyclistic Bike Share Analysis"
author: "Jennie Yu"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## 1. Load Packages

```{r}
library(tidyverse)
library(lubridate)
```

## 2. Import Data

```{r}
trip19 <- read_csv("Divvy_Trips_2019_Q1.csv")
trip20 <- read_csv("Divvy_Trips_2020_Q1.csv")
```

## 3. Data Cleaning & Transformation

### Align 2019 Dataset

```{r}
trip19_clean <- trip19 %>%
  rename(
    ride_id = trip_id,
    started_at = started_time,
    ended_at = end_time,
    start_station_name = from_station_name,
    end_station_name = to_station_name
  ) %>%
  mutate(
    member_casual = if_else(usertype == "Subscriber", "member", "casual"),
    ride_id = as.character(ride_id)
  ) %>%
  select(ride_id, started_at, ended_at, start_station_name, end_station_name, member_casual)
```

### Align 2020 Dataset

```{r}
trip20_clean <- trip20 %>%
  select(ride_id, started_at, ended_at, start_station_name, end_station_name, member_casual)
```

### Combine Datasets

```{r}
cleantrips <- bind_rows(trip19_clean, trip20_clean)
```

### Feature Engineering & Cleaning

```{r}
cleantrips <- cleantrips %>%
  mutate(
    ride_length = as.numeric(ended_at - started_at) / 60,
    day_of_week = wday(started_at, label = TRUE),
    time_of_day = hour(started_at)
  ) %>%
  drop_na() %>%
  distinct(ride_id, .keep_all = TRUE) %>%
  filter(ride_length > 0, ended_at > started_at)
```

## 4. Analysis

### Average Ride Length by User Type

```{r}
summary1 <- cleantrips %>%
  group_by(member_casual) %>%
  summarize(
    ride_count = n(),
    avg_ride_length = mean(ride_length)
  )
summary1
```

### Weekly Ride Patterns

```{r}
summary2 <- cleantrips %>%
  group_by(member_casual, day_of_week) %>%
  summarize(
    ride_count = n(),
    avg_ride_length = mean(ride_length),
    .groups = "drop"
  )
summary2
```

### Peak Ride Times

```{r}
summary3 <- cleantrips %>%
  group_by(member_casual, day_of_week) %>%
  summarize(
    peak_time_top3 = list(names(sort(table(time_of_day), decreasing = TRUE))[1:3]),
    .groups = "drop"
  )
summary3
```

## 5. Visualizations

### Average Ride Length

```{r}
ggplot(summary1, aes(x = member_casual, y = avg_ride_length)) +
  geom_col() +
  labs(
    title = "Average Ride Length by User Type",
    x = "User Type",
    y = "Average Ride Length (minutes)"
  )
```

### Ride Count by Day of Week

```{r}
ggplot(summary2, aes(x = day_of_week, y = ride_count)) +
  geom_col() +
  facet_wrap(~member_casual) +
  labs(
    title = "Ride Count by Day of Week",
    x = "Day of Week",
    y = "Number of Rides"
  )
```

### Commute Pattern Heatmap

```{r}
summary4 <- cleantrips %>%
  group_by(member_casual, day_of_week, time_of_day) %>%
  summarize(ride_count = n(), .groups = "drop")

summary4$day_of_week <- factor(
  summary4$day_of_week,
  levels = c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun")
)

ggplot(summary4, aes(x = time_of_day, y = day_of_week, fill = ride_count)) +
  geom_tile() +
  facet_wrap(~member_casual) +
  scale_x_continuous(breaks = seq(0, 23, 3)) +
  labs(
    title = "Ride Count Heatmap by Day and Hour",
    x = "Hour of Day",
    y = "Day of Week",
    fill = "Ride Count"
  )